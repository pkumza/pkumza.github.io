<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> OS X下搭建Cocos2d-x 3.2的Android环境 · Zablog</title><meta name="description" content="OS X下搭建Cocos2d-x 3.2的Android环境 - Zachary Marv"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://zablog.me/atom.xml" title="Zablog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/Aggerfrank" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pkumza" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">OS X下搭建Cocos2d-x 3.2的Android环境</h1><div class="post-info">2014年8月26日</div><div class="post-content"><h2 id="下载Cocos2d-x"><a href="#下载Cocos2d-x" class="headerlink" title="下载Cocos2d-x"></a>下载Cocos2d-x</h2><p>下载地址<br><a href="http://cn.cocos2d-x.org/download/" target="_blank" rel="noopener">http://cn.cocos2d-x.org/download/</a><br>当前最新版本是v3.2<br>解压到合适的位置，这里我解压到了/Applications/文件夹下，路径为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/Applications/cocos2d-x-3.2</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<h2 id="下载SDK"><a href="#下载SDK" class="headerlink" title="下载SDK"></a>下载SDK</h2><p>建议到Android官方地址下载ADT Bundle for Mac，这样就省去下载Eclipse和配置SDK的时间了。<br>下载地址<a href="http://developer.android.com/sdk/index.html" target="_blank" rel="noopener">http://developer.android.com/sdk/index.html</a><br>我下载的内容是adt-bundle-mac-x86_64-20140702.zip<br>下载地址是<a href="http://dl.google.com/android/adt/adt-bundle-mac-x86_64-20140702.zip" target="_blank" rel="noopener">http://dl.google.com/android/adt/adt-bundle-mac-x86_64-20140702.zip</a></p>
<h2 id="下载NDK"><a href="#下载NDK" class="headerlink" title="下载NDK"></a>下载NDK</h2><p>下载地址是<a href="http://developer.android.com/tools/sdk/ndk/index.html" target="_blank" rel="noopener">http://developer.android.com/tools/sdk/ndk/index.html</a><br>在尝试中，我首先下载了ndk版本为r9c，但是出现错误。错误后面会说明<br>后来我尝试下载了最新版的ndk64，版本为r10，但也出现了错误。错误后面会说明<br>保险起见，最后我下载了ndk r9d，发现可以使用。<br>把NDK解压到合适的位置，这里我解压到了/Applications/adt/文件夹下，路径为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/Applications/adt/android-ndk-r9d</div></pre></td></tr></table></figure></p>
<h2 id="下载JDK"><a href="#下载JDK" class="headerlink" title="下载JDK"></a>下载JDK</h2><p>首先检测JDK是否安装，打开命令行，输入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -version</div></pre></td></tr></table></figure></p>
<p>如果java命令可用，就说明已经下载好了java。我的提示信息如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">java version <span class="string">"1.8.0_05"</span></div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_05-b13)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.5-b02, mixed mode)</div></pre></td></tr></table></figure></p>
<p>这说明我已经安装了1.8.0_05版本的JDK</p>
<h2 id="解压ADT-Bundle"><a href="#解压ADT-Bundle" class="headerlink" title="解压ADT-Bundle"></a>解压ADT-Bundle</h2><p>把之前下载的ADT-bundle的zip文件解压到适当的位置，我解压到了/Applications文件夹。路径为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/Applications/adt-bundle-mac-x86_64-20140702</div></pre></td></tr></table></figure></p>
<p>打开adt-bundle下的eclipse文件夹，打开eclipse，尝试创立一个Hello World的Android程序。如果成功，说明Eclipse已经准备就绪。</p>
<h2 id="配置NDK环境"><a href="#配置NDK环境" class="headerlink" title="配置NDK环境"></a>配置NDK环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/profile</div></pre></td></tr></table></figure>
<p>在下面加上这一行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">export</span> NDK_ROOT = <span class="string">"/Applications/adt/android-ndk-r9d"</span></div></pre></td></tr></table></figure></p>
<p>重启终端才能生效。</p>
<h2 id="创建HelloWorld项目"><a href="#创建HelloWorld项目" class="headerlink" title="创建HelloWorld项目"></a>创建HelloWorld项目</h2><p>进入Cocos2dx的文件夹，并调用cocos命令。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /Applications/cocos2d-x-3.2/tools/cocos2d-console/bin/</div><div class="line">cocos new HelloWorld\_for\_Android -p com.maziang.hi -l cpp -d ~/Desktop/Work</div></pre></td></tr></table></figure></p>
<p>这样就建立了一个项目</p>
<h2 id="编译为Android项目文件"><a href="#编译为Android项目文件" class="headerlink" title="编译为Android项目文件"></a>编译为Android项目文件</h2><p>执行proj.android目录下的build_native.py命令<br>使用ndk版本为r9c的时候，出现如下错误:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ ./build_native.py </div><div class="line">The Selected NDK toolchain version was 4.8 !</div><div class="line">Android NDK: WARNING: APP_PLATFORM android-19 is larger than android:minSdkVersion 9 <span class="keyword">in</span> ./AndroidManifest.xml    </div><div class="line">Android NDK: Invalid APP_STL value: c++_static    </div><div class="line">Android NDK: Please use one of the following instead:  system stlport_static stlport_static_hard stlport_shared stlport_shared_hard gnustl_static gnustl_shared gabi++_static gabi++_shared libc++_static libc++_shared none    </div><div class="line">/Applications/adt/android-ndk-r9c/build/core/add-application.mk:274: *** Android NDK: Aborting    .  Stop.</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"./build_native.py"</span>, line 159, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">    build(opts.ndk_build_param,opts.android_platform,opts.build_mode)</div><div class="line">  File <span class="string">"./build_native.py"</span>, line 146, <span class="keyword">in</span> build</div><div class="line">    do_build(cocos_root, ndk_root, app_android_root,ndk_build_param,sdk_root,android_platform,build_mode)</div><div class="line">  File <span class="string">"./build_native.py"</span>, line 82, <span class="keyword">in</span> do_build</div><div class="line">    raise Exception(<span class="string">"Build dynamic library for project [ "</span> + app_android_root + <span class="string">" ] fails!"</span>)</div><div class="line">Exception: Build dynamic library <span class="keyword">for</span> project [ /Users/marchon/Desktop/plter/Hello_Android_From_Cocos2dx/proj.android ] fails!</div></pre></td></tr></table></figure>
<p>当使用64位ndk，版本r10的时候，出现如下错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">$ ./build_native.py </div><div class="line">Couldn<span class="string">'t find the gcc toolchain.</span></div><div class="line"><span class="string">``` </span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">当使用ndk版本为r9d的时候，成功编译。</span></div><div class="line"><span class="string">第一次编译时间会比较久，以后就会好一些。</span></div><div class="line"><span class="string">事实上，并非r10不支持Cocos2d-x，而是因为我下载r10的时候下载了64位的版本。</span></div><div class="line"><span class="string">这是因为*【Android L】*推出以后，Android设备要开始进入64位时代，所以推出了64位的ndk。但是Cocos2d-x暂时还没有支持64位的ndk，因此下载64位的ndk，就会出现错误。</span></div><div class="line"><span class="string">ndk的32、64位和Mac操作系统或者Windows操作系统的32、64位又不是一回事，所以现在ndk的下载页面，有12个选项可以下载，分别是</span></div><div class="line"><span class="string">| 32位NDK | 32位Windows |</span></div><div class="line"><span class="string">| 32位NDK | 64位Windows |</span></div><div class="line"><span class="string">| 32位NDK | 32位OS X    |</span></div><div class="line"><span class="string">| 32位NDK | 64位OS X    |</span></div><div class="line"><span class="string">| 32位NDK | 32位Linux   |</span></div><div class="line"><span class="string">| 32位NDK | 64位Linux   |</span></div><div class="line"><span class="string">| 64位NDK | 32位Windows |</span></div><div class="line"><span class="string">| 64位NDK | 64位Windows |</span></div><div class="line"><span class="string">| 64位NDK | 32位OS X    |</span></div><div class="line"><span class="string">| 64位NDK | 64位OS X    |</span></div><div class="line"><span class="string">| 64位NDK | 32位Linux   |</span></div><div class="line"><span class="string">| 64位NDK | 64位Linux   | </span></div><div class="line"><span class="string">这里，我重新下载了32位NDK 64位OS X的包，下载后解压，并设置/etc/profile，和r9d一样，也可以成功运行。</span></div><div class="line"><span class="string">```bash</span></div><div class="line"><span class="string">export NDK_ROOT = "/Applications/adt/android-ndk-r10"</span></div></pre></td></tr></table></figure>
<p>注意这个android-ndk-r10和64位版本是重名的，因此我提前把64位的没法使用的ndk更名位android-ndk-r10-64了。<br>现在这个r10的ndk虽然不是64位的，但是至少也是最高的版本，自此，本教程所有的软件、内容、开发工具都是最新的版本了。<br>不过依然不建议使用r10的版本，尤其是看到这个问题之后：<br><a href="http://cn.cocos2d-x.org/tutorial/show?id=1187" target="_blank" rel="noopener">http://cn.cocos2d-x.org/tutorial/show?id=1187</a><br>使用r10版本会出现如下错误：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/Users/minggo/SourceCode/cocos2d-x/build/../cocos/./3d/CCBundleReader.cpp:94:23: error: </div><div class="line">  <span class="built_in">return</span> <span class="built_in">type</span> of out-of-line definition of <span class="string">'cocos2d::BundleReader::tell'</span></div><div class="line">  differs from that <span class="keyword">in</span> the declaration</div><div class="line">ssize_t BundleReader::tell()</div><div class="line">  ^</div><div class="line">/Users/minggo/SourceCode/cocos2d-x/build/../cocos/./3d/CCBundleReader.h:90:14: note: </div><div class="line">  previous declaration is here</div><div class="line">long int tell();</div></pre></td></tr></table></figure></p>
<p>该链接错误解决起来比较困难，已经超出了普通的Cocos2D-x的学习范畴，所以在Cocos2D-x官方给出解决方案以前，不要使用r10的NDK。<br>（PS:正式版中最新，2014年8月25日。）</p>
<h2 id="导入项目到Eclipse"><a href="#导入项目到Eclipse" class="headerlink" title="导入项目到Eclipse"></a>导入项目到Eclipse</h2><p>在Eclipse中，选择File-&gt;import，然后导入Android程序Existing Android Code Into Workspace<br>导入成功之后会有错误提示，这个时候还需要把一个lib文件夹导入到里面。<br>最新版和旧版路径不一样，在3.2版本中，需要把Path_to_your_demo/cocos2d/cocos/platform/android/java/src文件夹下的org文件夹导入进来，和已有的代码文件并列。<br>这个时候，点击运行，再选择设备，就可以成功地在Android手机上运行Cocos2dx的程序了。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2014/11/29/Mahjong/" class="prev">PREV</a><a href="/2014/07/21/Python-encode/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'maziang';
var disqus_identifier = '2014/08/26/OS-X-Cocos2Dx-Android/';
var disqus_title = 'OS X下搭建Cocos2d-x 3.2的Android环境';
var disqus_url = 'http://zablog.me/2014/08/26/OS-X-Cocos2Dx-Android/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//maziang.disqus.com/count.js" async></script><div class="copyright"><p>© 2014 - 2021 <a href="http://zablog.me">Zachary Marv</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-71255155-1",'auto');ga('send','pageview');</script></body></html>